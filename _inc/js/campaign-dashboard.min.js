function WDGCampaignDashboard(){this.walletTimetableDatatable,this.initWithHash(),this.initMenu(),this.drawTimetable(),this.initAjaxForms()}WDGCampaignDashboard.prototype.initWithHash=function(){var e=window.location.hash.substring(1);""!==e?this.switchTab(e):this.switchTab("home")},WDGCampaignDashboard.prototype.initMenu=function(){var e=this;$("ul.nav-menu li a").each(function(){$(this).click(function(){e.switchTab($(this).data("tab"))})})},WDGCampaignDashboard.prototype.switchTab=function(e){$("ul.nav-menu li").removeClass("selected"),$("div#item-body > div.item-body-tab").hide(),$("ul.nav-menu li#menu-item-"+e).addClass("selected"),$("div#item-body > div#item-body-"+e).show()},WDGCampaignDashboard.prototype.initAjaxForms=function(){var e=this;$("form.ajax-db-form").submit(function(t){if(""==$(this).attr("action")||void 0==$(this).attr("action")){if(t.preventDefault(),void 0==$(this).data("action"))return!1;var a=$(this),i={action:$(this).data("action"),campaign_id:campaign_id};$(this).find(".field-value").each(function(e){var t=$(this).data("id");switch($(this).data("type")){case"datetime":var a=$(this).find("input:eq(0)").val().split("/");i[t]=a[1]+"/"+a[0]+"/"+a[2]+" "+$(this).find("select:eq(0)").val()+":"+$(this).find("select:eq(1)").val();break;case"editor":i[t]=tinyMCE.get(t).getContent();break;case"check":i[t]=$("#"+t).is(":checked");break;case"multicheck":var n=new Array;$("input",this).each(function(){$(this).is(":visible")&&$(this).is(":checked")&&n.push($(this).val())}),i[t]=n;break;case"text":case"number":case"date":case"link":case"textarea":case"select":default:i[t]=$(":input",this).val()}void 0==i[t]&&delete i[t]});var n=$("#"+$(this).attr("id")+"_button");n.find(".button-text").hide(),n.find(".button-waiting").show(),$(":input",this).prop("disabled",!0),a.find(".feedback_save span").fadeOut(),$.ajax({type:"POST",url:ajax_object.ajax_url,data:i}).done(function(t){if(""!=t){var i=JSON.parse(t);feedback=i;for(var n in feedback.errors)e.fieldError(a.find("#"+n),feedback.errors[n]);for(var n in feedback.success){var o=a.find("#"+n);e.removeFieldError(o),o.closest(".field-value").parent().find("i.fa.validation").remove(),o.addClass("validation"),o.closest(".field-value").after('<i class="fa fa-check validation" aria-hidden="true"></i>')}var s=a.find(".error").first();1==s.length?(e.scrollTo(s),s.focus(),a.find(".save_errors").fadeIn()):a.find(".save_ok").fadeIn(),$("#tab-organization").is(":visible")&&"save_project_organization"==$("#ndashboard #orgainfo_form.db-form").data("action")&&($("#save-mention").hide(),$("#orgainfo_form_button").hide(),a.find(".save_ok").hide(),$("#tab-organization #wdg-lightbox-valid-changeOrga").css("display","block"),new_project_organization=$("#new_project_organization option:selected").val())}}).fail(function(){a.find(".save_fail").fadeIn()}).always(function(){n.find(".button-waiting").hide(),n.find(".button-text").show(),a.find(":input").prop("disabled",!1)})}})},WDGCampaignDashboard.prototype.getContactsTable=function(e,t){var a=this;$.ajax({type:"POST",url:ajax_object.ajax_url,data:{action:"create_contacts_table",id_campaign:t,data:e}}).done(function(e){$("#ajax-contacts-load").after(e),$("#ajax-loader-img").hide(),YPUIFunctions.initQtip(),a.table=$("#contacts-table").DataTable({scrollX:"100%",scrollY:"70vh",scrollCollapse:!0,paging:!1,order:[[result_contacts_table.default_sort,"desc"]],colReorder:{fixedColumnsLeft:result_contacts_table.id_column_index+1},fixedColumns:{leftColumns:result_contacts_table.id_column_index+1},columnDefs:[{targets:result_contacts_table.array_hidden,visible:!1},{targets:[result_contacts_table.id_column_index],visible:!1},{className:"select-checkbox",targets:0,orderable:!1},{width:"30px",className:"dt-body-center nopadding",targets:[2,3,4]}],select:{style:"multi",selector:"td:first-child"},dom:"Bfrtip",buttons:[{text:'<i class="fa fa-square-o" aria-hidden="true"></i> Sélectionner les éléments affichés',action:function(){a.table.rows({search:"applied"}).select()}},{extend:"selected",text:'<i class="fa fa-envelope" aria-hidden="true"></i> Envoyer un mail',action:function(e,t,i,n){$("#send-mail-tab").slideDown();$(this).data("target");a.scrollTo($("#send-mail-tab"))}},{extend:"collection",text:'<i class="fa fa-eye" aria-hidden="true"></i> Informations à afficher',buttons:[{extend:"colvis",text:'<i class="fa fa-columns" aria-hidden="true"></i> Colonnes à afficher',columns:":gt("+result_contacts_table.id_column_index+")",collectionLayout:"two-column"},{extend:"colvisGroup",text:"Tout afficher",show:":gt("+result_contacts_table.id_column_index+"):hidden"},{extend:"colvisGroup",text:"Tout masquer",hide:":gt("+result_contacts_table.id_column_index+")"},{extend:"colvisRestore",text:'<i class="fa fa-refresh" aria-hidden="true"></i> Rétablir colonnes par défaut'}]},{extend:"collection",text:'<i class="fa fa-download" aria-hidden="true"></i> Exporter',buttons:[{extend:"excel",text:'<i class="fa fa-file-excel-o" aria-hidden="true"></i> Fichier Excel',exportOptions:{modifier:{columns:":visible"}}},{extend:"print",text:'<i class="fa fa-print" aria-hidden="true"></i> Imprimer',exportOptions:{modifier:{columns:":visible"}}}]}],language:{sProcessing:"Traitement en cours...",sSearch:"Rechercher&nbsp;:",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Aucun &eacute;l&eacute;ment &agrave; afficher",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"Pr&eacute;c&eacute;dent",sNext:"Suivant",sLast:"Dernier"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"},select:{rows:{_:"<br /><b>%d</b> contacts sélectionnés",0:"<br />Cliquez sur un contact pour le sélectionner",1:"<br /><b>1</b> contact sélectionné"}}}}),a.table.columns.adjust();var t=a.table.button(1).text();a.table.on("select.dt deselect.dt",function(e,i,n,o){var s=a.table.rows({selected:!0}).count();0==s?(a.table.button(1).text(t),$("#send-mail-tab").slideUp()):a.table.button(1).text(t+" ("+s+")");var r=!0;a.table.rows({search:"applied"}).every(function(e,t,i){-1==$.inArray(e,a.table.rows({selected:!0}).indexes())&&(r=!1)}),r?(a.table.button(0).text('<i class="fa fa-check-square-o" aria-hidden="true"></i> Déselectionner les éléments affichés'),a.table.button(0).action(function(){a.table.rows({search:"applied"}).deselect()})):(a.table.button(0).text('<i class="fa fa-square-o" aria-hidden="true"></i> Sélectionner les éléments affichés'),a.table.button(0).action(function(){a.table.rows({search:"applied"}).select()})),$("#nb-mailed-contacts").text(s);var c=[];$.each(a.table.rows({selected:!0}).data(),function(e,t){c.push(t[result_contacts_table.id_column_index])}),$("#mail_recipients").val(c)}),$(a.table.table().container()).on("keyup","tfoot .text input",function(){a.table.column($(this).data("index")).search(this.value).draw()}),$(a.table.table().container()).on("change","tfoot .check input",function(){$(this).is(":checked")?a.table.column($(this).data("index")).search("1").draw():a.table.column($(this).data("index")).search("").draw()})}).fail(function(){$("#ajax-contacts-load").after("<em>Le chargement du tableau a échoué</em>"),$("#ajax-loader-img").hide()})},WDGCampaignDashboard.prototype.drawTimetable=function(){$("#wdg-timetable tfoot td").each(function(){$(this).prepend('<input type="text" placeholder="Filtrer par :" class="col-filter"/><br/>')}),$("#wdg-timetable tfoot input").on("keyup change",function(){walletTimetable.column($(this).parent().index()+":visible").search(this.value).draw()}),sortColumn=0,this.walletTimetableDatatable=$("#wdg-timetable").DataTable({scrollX:!0,order:[[sortColumn,"asc"]],dom:'RC<"clear">lfrtip',lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"Tous"]],iDisplayLength:50,colVis:{buttonText:"Afficher/cacher colonnes",restore:"Restaurer",showAll:"Tout afficher",showNone:"Tout cacher",overlayFade:100},language:{sProcessing:"Traitement en cours...",sSearch:"Rechercher&nbsp;:",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de l'&eacute;l&eacute;ment _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Affichage de l'&eacute;l&eacute;ment 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"Pr&eacute;c&eacute;dent",sNext:"Suivant",sLast:"Dernier"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"}}})},WDGCampaignDashboard.prototype.scrollTo=function(e){$("html, body, .wdg-lightbox-padder").animate({scrollTop:e.offset().top-75},"slow")},WDGCampaignDashboard.prototype.fieldError=function(e,t){e.addClass("error"),e.removeClass("validation"),e.qtip({content:t,position:{my:"bottom center",at:"top center"},style:{classes:"wdgQtip qtip-red qtip-rounded qtip-shadow"},show:"focus",hide:"blur"}),e.closest(".field-value").parent().find("i.fa.validation").remove()},WDGCampaignDashboard.prototype.removeFieldError=function(e){e.hasClass("error")&&(e.removeClass("error"),e.qtip().destroy())};var wdgCampaignDashboard;$(function(){wdgCampaignDashboard=new WDGCampaignDashboard});