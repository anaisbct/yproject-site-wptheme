$(document).ready(function(){var c=JSON.parse(unescape(voteData)),e=JSON.parse(unescape(fundingData)),f=JSON.parse(unescape(cookies.campaign_url));var g=[],h=[],j=[],k=0,l=0,n=[],o=[],p={};$.each(c.list_vote.current,function(P,Q){'undefined'==typeof p[Q.date]&&(p[Q.date+'I'+P]={}),p[Q.date+'I'+P].list_vote=Q.sum}),$.each(c.list_preinvestment.current,function(P,Q){'undefined'==typeof p[Q.date]&&(p[Q.date+'I'+P]={}),p[Q.date+'I'+P].list_preinvestment=Q.sum}),$.each(c.list_vote.target,function(P,Q){'undefined'==typeof p[P]&&(p[P]={}),p[P].list_vote_target=Q}),$.each(c.list_preinvestment.target,function(P,Q){'undefined'==typeof p[P]&&(p[P]={}),p[P].list_preinvestment_target=Q}),p=sortObjectByKey(p),$.each(p,function(P,Q){var R=g.find(function(S){return S==formatDate(P)});'undefined'==typeof Q.list_preinvestment&&(Q.list_preinvestment=0),'undefined'==typeof Q.list_vote&&(Q.list_vote=0),'undefined'==typeof R?(g.push(formatDate(P)),l+=+Q.list_preinvestment,j.push(l),k+=+Q.list_vote,h.push(k),n.push(Q.list_vote_target),o.push(Q.list_preinvestment_target)):(j[j.length-1]+=+Q.list_preinvestment,l=j[j.length-1],h[h.length-1]+=+Q.list_vote,k=h[h.length-1])});var r=$('#goal-chart'),s=new Chart(r,{type:'line',data:{labels:g,datasets:[{label:'Objectifs de pr\xE9-investissements (\u20AC)',fill:!1,lineTension:0.1,backgroundColor:'#D3EAE9',borderColor:'#D3EAE9',data:o},{label:'Objectifs d\'intentions d\'investissements (\u20AC)',fill:!1,lineTension:0.1,backgroundColor:'#B4B4B4',borderColor:'#B4B4B4',data:n},{label:'Pr\xE9-investissements (\u20AC)',fill:!0,lineTension:0.1,backgroundColor:'rgba(0, 135, 155, 0.6)',borderColor:'#00879b',data:j},{label:'Intentions d\'investissements (\u20AC)',fill:!0,lineTension:0.1,backgroundColor:'rgba(180, 180, 180, 0.6)',borderColor:'#B4B4B4',data:h}]},options:{tooltips:{callbacks:{title:function(P,Q){return moment(Q.labels[P[0].index]).format('DD/MM/YYYY')}}},scales:{xAxes:[{type:'time',time:{unit:'day',min:g[0],displayFormats:{day:'DD/MM/YYYY'}}}]}}});new Chart(document.getElementById('risk-chart'),{type:'bar',data:{labels:['Tr\xE8s faible','Faible','Moyen','Risqu\xE9','Tr\xE8s risqu\xE9'],datasets:[{label:'',data:[c.risk[1],c.risk[2],c.risk[3],c.risk[4],c.risk[5]],fill:!1,backgroundColor:['#93626d','#93626d','#93626d','#93626d','#93626d']}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}});var t={children:[{name:'Impact<br>soci\xE9tal',value:c.more_info.impact},{name:'Produit<br>Service',value:c.more_info.product},{name:'Structure<br>de l\'\xE9quipe',value:c.more_info.team},{name:'Pr\xE9visionnel<br>financier',value:c.more_info.finance},{name:'Autre',value:c.more_info.other}]},u=600,v=d3.scaleOrdinal().range(['#93626d','#a37983','#b39199','#c4a9af','#d4c0c5']),w=d3.pack().size([u,u]).padding(5),x=d3.select('#chart-infos').append('svg').attr('width',600).attr('height',600).attr('class','chart-svg'),z=d3.hierarchy(t).sum(function(P){return P.value}).sort(function(P,Q){return Q.value-P.value});w(z);var A=x.selectAll('.node').data(z.children).enter().append('g').attr('class','node').attr('transform',function(P){return'translate('+P.x+' '+P.y+')'}).append('g').attr('class','graph');A.append('circle').attr('r',function(P){return P.r}).style('fill',function(P){return v(P.data.name)}),A.append('svg:title').text(function(P){return P.value+' internautes'}),A.append('foreignObject').attr('width',100).attr('height',100).attr('transform','translate(-50,-30)').append('xhtml:p').style('color','#FFF').style('text-align','center').attr('title',function(P){return P.value+' internautes'}).html(function(P){return P.data.name});var g=[],B=[],C=[],D=0,E={};$.each(e.list_investment.current,function(P,Q){'undefined'==typeof E[Q.date]&&(E[Q.date+'I'+P]={}),E[Q.date+'I'+P].list_investment_current=Q.sum}),$.each(e.list_investment.target,function(P,Q){'undefined'==typeof E[P]&&(E[P]={}),E[P].list_investment_target=Q}),E=sortObjectByKey(E),$.each(E,function(P,Q){var R=g.find(function(S){return S==formatDate(P)});'undefined'==typeof Q.list_investment_current&&(Q.list_investment_current=0),'undefined'==typeof R?(g.push(formatDate(P)),D+=+Q.list_investment_current,B.push(D),C.push(Q.list_investment_target)):(B[B.length-1]+=+Q.list_investment_current,D=B[B.length-1])});var r=$('#investment-chart'),s=new Chart(r,{type:'line',data:{labels:g,datasets:[{label:'Valeur des investissements (\u20AC)',fill:!0,lineTension:0.1,backgroundColor:'rgba(0, 135, 155, 0.6)',borderColor:'#00879b',data:B},{label:'Objectifs id\xE9aux',fill:!0,lineTension:0.1,backgroundColor:'rgba(180, 180, 180, 0.6)',borderColor:'#B4B4B4',data:C}]},options:{tooltips:{callbacks:{title:function(P,Q){return moment(Q.labels[P[0].index]).format('DD/MM/YYYY')}}},scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:'time',time:{unit:'day',min:g[0],displayFormats:{day:'DD/MM/YYYY'}}}]}}}),G={datasets:[{data:[e.stats.percent_men,e.stats.percent_women],backgroundColor:['#93626d','#b39199']}],labels:['Hommes','Femmes']},r=$('#sup-stats-chart');new Chart(r,{type:'doughnut',data:G,options:{cutoutPercentage:80,tooltips:{enabled:!0,mode:'single',callbacks:{label:function(P,Q){return Q.labels[P.index]+' : '+Q.datasets[P.datasetIndex].data[P.index]+' %'}}}}});var g=[],H=[],I=[],J=[],K=[],L={};$.each(c.list_vote.current,function(P,Q){'undefined'==typeof L[Q.date]&&(L[Q.date]={}),'undefined'==typeof L[Q.date.split('T')[0]].nb_vote?L[Q.date].nb_vote=1:L[Q.date].nb_vote+=1}),$.each(c.list_preinvestment.current,function(P,Q){'undefined'==typeof L[Q.date.split('T')[0]]&&(L[Q.date.split('T')[0]]={}),'undefined'==typeof L[Q.date.split('T')[0]].nb_preinvestment?L[Q.date.split('T')[0]].nb_preinvestment=1:L[Q.date.split('T')[0]].nb_preinvestment+=1}),$.each(e.list_investment.current,function(P,Q){'undefined'==typeof L[Q.date.split('T')[0]]&&(L[Q.date.split('T')[0]]={}),'undefined'==typeof L[Q.date.split('T')[0]].nb_investment?L[Q.date.split('T')[0]].nb_investment=1:L[Q.date.split('T')[0]].nb_investment+=1});var M={stat_type:'visits',start_date:c.start.split('T')[0],end_date:e.end.split('T')[0],path:f},N={stat_type:'sources',start_date:c.start.split('T')[0],end_date:e.end.split('T')[0],path:f},O={stat_type:'cities',start_date:c.start.split('T')[0],end_date:e.end.split('T')[0],path:f};$.ajax({url:'../wp-content/plugins/appthemer-crowdfunding/analytics-api/visits.php',type:'POST',data:M,dataType:'json',success:function(P){var Q=[];for(var S in P){var Q=formatGoogleDate(P[S].date);'undefined'==typeof L[Q]&&(L[Q]={}),L[Q].visits=P[S].visits}L=sortObjectByKey(L),$.each(L,function(W,X){g.push(formatDate(W)),K.push(X.visits),X.nb_vote===void 0?H.push(0):H.push(X.nb_vote),X.nb_investment===void 0?I.push(0):I.push(X.nb_investment),X.nb_preinvestment===void 0?J.push(0):J.push(X.nb_preinvestment)});var U=$('#visit-chart'),V=new Chart(U,{type:'bar',data:{labels:g,datasets:[{label:'Visites',fill:!0,lineTension:0.1,backgroundColor:'rgba(167,167,167,0.6)',borderColor:'#A7A7A7',data:K,type:'line',yAxisID:'A'},{label:'\xC9valuations',yAxisID:'B',data:H,backgroundColor:'#8A5658'},{label:'Investissements',yAxisID:'B',data:I,backgroundColor:'#1691A3'},{label:'Pr\xE9-investissements',yAxisID:'B',data:J,backgroundColor:'#66B7C3'}]},options:{tooltips:{callbacks:{title:function(W,X){return moment(X.labels[W[0].index]).format('DD/MM/YYYY')}}},scales:{yAxes:[{id:'A',type:'linear',position:'left',ticks:{beginAtZero:!0}},{id:'B',type:'linear',position:'right',ticks:{beginAtZero:!0}}],xAxes:[{type:'time',time:{unit:'day',min:g[0],displayFormats:{day:'DD/MM/YYYY'}}}]}}})},error:function(){}}),$.ajax({url:'../wp-content/plugins/appthemer-crowdfunding/analytics-api/visits.php',type:'POST',data:N,dataType:'json',success:function(P){var Q=[],R=[];for(var S in P)Q.push(P[S].source),R.push(P[S].visits);var U=$('#chanel-chart'),V=new Chart(U,{type:'pie',data:{labels:Q,datasets:[{label:'Visites',data:R,backgroundColor:['#8F4D5B','#93626D','#A37982','#B39098','#BEA0A7']}]}})},error:function(){}}),$.ajax({url:'../wp-content/plugins/appthemer-crowdfunding/analytics-api/visits.php',type:'POST',data:O,dataType:'json',success:function(P){var S=0;for(var T in P)S+=P[T].visits;for(var T in P)5>T?$('#cities-tab tr:last').after('<tr class="txt-center"><td>'+P[T].cities+'</td><td>'+P[T].visits+'</td><td>'+(100*P[T].visits/S).toFixed(1)+' %</td></tr>'):$('#cities-tab tr:last').after('<tr style="display:none;" class="txt-center"><td>'+P[T].cities+'</td><td>'+P[T].visits+'</td><td>'+(100*P[T].visits/S).toFixed(1)+' %</td></tr>')},error:function(){}});});var sortObjectByKey=function(c){var e=[],f={};for(var g in c)c.hasOwnProperty(g)&&e.push(g);return e.sort(),$.each(e,function(h,j){f[j]=c[j]}),f},cookies=document.cookie.split('; ').map(function(c){return c.split('=')}).reduce(function(c,e){return c[e[0]]=e[1],c},{});function formatDate(c){if(-1!=c.indexOf('T'))var c=c.split('T')[0];else var c=c.split('I')[0];return c}function formatGoogleDate(c){var e=c+'',f=e.substring(0,4),g=e.substring(4,6),h=e.substring(6,8);return f+'-'+g+'-'+h}Chart.pluginService.register({beforeDatasetsDraw:function(c){for(dataset of c.config.data.datasets)for(data of dataset._meta[c.id].data)data._model.skip=!1,data._model.tension=0}});