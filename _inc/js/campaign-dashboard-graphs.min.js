$(document).ready(function(){var t=JSON.parse(unescape(voteData)),e=JSON.parse(unescape(fundingData)),a=JSON.parse(unescape(cookies.campaign_url));switch(tab){case"evaluations":var s=[],n=[],i=[],r=0,o=0,l=[],d=[],c={};$.each(t.list_vote.current,function(t,e){void 0===c[e.date]&&(c[e.date+"I"+t]={}),c[e.date+"I"+t].list_vote=e.sum}),$.each(t.list_preinvestment.current,function(t,e){void 0===c[e.date]&&(c[e.date+"I"+t]={}),c[e.date+"I"+t].list_preinvestment=e.sum}),$.each(t.list_vote.target,function(t,e){void 0===c[t]&&(c[t]={}),c[t].list_vote_target=e}),$.each(t.list_preinvestment.target,function(t,e){void 0===c[t]&&(c[t]={}),c[t].list_preinvestment_target=e}),c=sortObjectByKey(c),$.each(c,function(e,t){var a=s.find(function(t){return t==formatDate(e)});void 0===t.list_preinvestment&&(t.list_preinvestment=0),void 0===t.list_vote&&(t.list_vote=0),void 0===a?(s.push(formatDate(e)),o+=Number(t.list_preinvestment),i.push(o),r+=Number(t.list_vote),n.push(r),l.push(t.list_vote_target),d.push(t.list_preinvestment_target)):(i[i.length-1]+=Number(t.list_preinvestment),o=i[i.length-1],n[n.length-1]+=Number(t.list_vote),r=n[n.length-1])});var u={labels:s,datasets:[{label:"Objectifs de pré-investissements (€)",fill:!1,lineTension:.1,backgroundColor:"#D3EAE9",borderColor:"#D3EAE9",data:d},{label:"Objectifs d'intentions d'investissements (€)",fill:!1,lineTension:.1,backgroundColor:"#B4B4B4",borderColor:"#B4B4B4",data:l},{label:"Pré-investissements (€)",fill:!0,lineTension:.1,backgroundColor:"rgba(0, 135, 155, 0.6)",borderColor:"#00879b",data:i},{label:"Intentions d'investissements (€)",fill:!0,lineTension:.1,backgroundColor:"rgba(180, 180, 180, 0.6)",borderColor:"#B4B4B4",data:n}]},p=$("#goal-chart");new Chart(p,{type:"line",data:u,options:{tooltips:{callbacks:{title:function(t,e){return moment(e.labels[t[0].index]).format("DD/MM/YYYY")}}},scales:{xAxes:[{type:"time",time:{unit:"day",min:s[0],displayFormats:{day:"DD/MM/YYYY"}}}]}}});new Chart(document.getElementById("risk-chart"),{type:"bar",data:{labels:["Très faible","Faible","Moyen","Risqué","Très risqué"],datasets:[{label:"",data:[t.risk[1],t.risk[2],t.risk[3],t.risk[4],t.risk[5]],fill:!1,backgroundColor:["#93626d","#93626d","#93626d","#93626d","#93626d"]}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}});var v={children:[{name:"Impact<br>sociétal",value:t.more_info.impact},{name:"Produit<br>Service",value:t.more_info.product},{name:"Structure<br>de l'équipe",value:t.more_info.team},{name:"Prévisionnel<br>financier",value:t.more_info.finance},{name:"Autre",value:t.more_info.other}]},m=d3.scaleOrdinal().range(["#93626d","#a37983","#b39199","#c4a9af","#d4c0c5"]),b=d3.pack().size([600,600]).padding(5),f=d3.select("#chart-infos").append("svg").attr("width",600).attr("height",600).attr("class","chart-svg"),h=d3.hierarchy(v).sum(function(t){return t.value}).sort(function(t,e){return e.value-t.value});b(h);var _=f.selectAll(".node").data(h.children).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.x+" "+t.y+")"}).append("g").attr("class","graph");_.append("circle").attr("r",function(t){return t.r}).style("fill",function(t){return m(t.data.name)}),_.append("svg:title").text(function(t){return t.value+" internautes"}),_.append("foreignObject").attr("width",100).attr("height",100).attr("transform","translate(-50,-30)").append("xhtml:p").style("color","#FFF").style("text-align","center").attr("title",function(t){return t.value+" internautes"}).html(function(t){return t.data.name});break;case"levee-de-fonds":s=[];var g=[],y=[],k=0,T={};$.each(e.list_investment.current,function(t,e){void 0===T[e.date]&&(T[e.date+"I"+t]={}),T[e.date+"I"+t].list_investment_current=e.sum}),$.each(e.list_investment.target,function(t,e){void 0===T[t]&&(T[t]={}),T[t].list_investment_target=e}),T=sortObjectByKey(T),$.each(T,function(e,t){var a=s.find(function(t){return t==formatDate(e)});void 0===t.list_investment_current&&(t.list_investment_current=0),void 0===a?(s.push(formatDate(e)),k+=Number(t.list_investment_current),g.push(k),y.push(t.list_investment_target)):(g[g.length-1]+=Number(t.list_investment_current),k=g[g.length-1])});var x={labels:s,datasets:[{label:"Valeur des investissements (€)",fill:!0,lineTension:.1,backgroundColor:"rgba(0, 135, 155, 0.6)",borderColor:"#00879b",data:g},{label:"Objectifs idéaux",fill:!0,lineTension:.1,backgroundColor:"rgba(180, 180, 180, 0.6)",borderColor:"#B4B4B4",data:y}]},D=(p=$("#investment-chart"),new Chart(p,{type:"line",data:x,options:{tooltips:{callbacks:{title:function(t,e){return moment(e.labels[t[0].index]).format("DD/MM/YYYY")}}},scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unit:"day",min:s[0],displayFormats:{day:"DD/MM/YYYY"}}}]}}}),{datasets:[{data:[e.stats.percent_men,e.stats.percent_women],backgroundColor:["#93626d","#b39199"]}],labels:["Hommes","Femmes"]});p=$("#sup-stats-chart");new Chart(p,{type:"doughnut",data:D,options:{cutoutPercentage:80,tooltips:{enabled:!0,mode:"single",callbacks:{label:function(t,e){return e.labels[t.index]+" : "+e.datasets[t.datasetIndex].data[t.index]+" %"}}}}});break;case"visites":s=[];var A=[],C=[],B=[],Y=[],O={};$.each(t.list_vote.current,function(t,e){void 0===O[e.date]&&(O[e.date]={}),void 0===O[e.date.split("T")[0]].nb_vote?O[e.date].nb_vote=1:O[e.date].nb_vote+=1}),$.each(t.list_preinvestment.current,function(t,e){void 0===O[e.date.split("T")[0]]&&(O[e.date.split("T")[0]]={}),void 0===O[e.date.split("T")[0]].nb_preinvestment?O[e.date.split("T")[0]].nb_preinvestment=1:O[e.date.split("T")[0]].nb_preinvestment+=1}),$.each(e.list_investment.current,function(t,e){void 0===O[e.date.split("T")[0]]&&(O[e.date.split("T")[0]]={}),void 0===O[e.date.split("T")[0]].nb_investment?O[e.date.split("T")[0]].nb_investment=1:O[e.date.split("T")[0]].nb_investment+=1});var I={stat_type:"visits",start_date:t.start.split("T")[0],end_date:e.end.split("T")[0],path:a},w={stat_type:"sources",start_date:t.start.split("T")[0],end_date:e.end.split("T")[0],path:a},j={stat_type:"cities",start_date:t.start.split("T")[0],end_date:e.end.split("T")[0],path:a};$.ajax({url:"wdg-api-analytics/visits.php",type:"POST",data:I,dataType:"json",timeout:3e4,success:function(t){var e=[];for(var a in t){e=formatGoogleDate(t[a].date);void 0===O[e]&&(O[e]={}),O[e].visits=t[a].visits}O=sortObjectByKey(O),$.each(O,function(t,e){s.push(formatDate(t)),Y.push(e.visits),void 0===e.nb_vote?A.push(0):A.push(e.nb_vote),void 0===e.nb_investment?C.push(0):C.push(e.nb_investment),void 0===e.nb_preinvestment?B.push(0):B.push(e.nb_preinvestment)});var n={labels:s,datasets:[{label:"Visites",fill:!0,lineTension:.1,backgroundColor:"rgba(167,167,167,0.6)",borderColor:"#A7A7A7",data:Y,type:"line",yAxisID:"A"},{label:"Évaluations",yAxisID:"B",data:A,backgroundColor:"#8A5658"},{label:"Investissements",yAxisID:"B",data:C,backgroundColor:"#1691A3"},{label:"Pré-investissements",yAxisID:"B",data:B,backgroundColor:"#66B7C3"}]},i=$("#visit-chart");new Chart(i,{type:"bar",data:n,options:{tooltips:{callbacks:{title:function(t,e){return moment(e.labels[t[0].index]).format("DD/MM/YYYY")}}},scales:{yAxes:[{id:"A",type:"linear",position:"left",ticks:{beginAtZero:!0}},{id:"B",type:"linear",position:"right",ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unit:"day",min:s[0],displayFormats:{day:"DD/MM/YYYY"}}}]}}})},error:function(t){}}),$.ajax({url:"wdg-api-analytics/visits.php",type:"POST",data:w,dataType:"json",timeout:3e4,success:function(t){var e=[],a=[];for(var n in t)e.push(t[n].source),a.push(t[n].visits);var i={labels:e,datasets:[{label:"Visites",data:a,backgroundColor:["#8F4D5B","#93626D","#A37982","#B39098","#BEA0A7"]}]},s=$("#chanel-chart");new Chart(s,{type:"pie",data:i})},error:function(t){}}),$.ajax({url:"wdg-api-analytics/visits.php",type:"POST",data:j,dataType:"json",timeout:3e4,success:function(t){var e=0;for(var a in t)e+=t[a].visits;for(var a in t)a<5?$("#cities-tab tr:last").after('<tr class="txt-center"><td>'+t[a].cities+"</td><td>"+t[a].visits+"</td><td>"+(100*t[a].visits/e).toFixed(1)+" %</td></tr>"):$("#cities-tab tr:last").after('<tr style="display:none;" class="txt-center"><td>'+t[a].cities+"</td><td>"+t[a].visits+"</td><td>"+(100*t[a].visits/e).toFixed(1)+" %</td></tr>")},error:function(t){}})}});var sortObjectByKey=function(a){var t=[],n={};for(var e in a)a.hasOwnProperty(e)&&t.push(e);return t.sort(),$.each(t,function(t,e){n[e]=a[e]}),n},cookies=document.cookie.split("; ").map(function(t){return t.split("=")}).reduce(function(t,e){return t[e[0]]=e[1],t},{});function formatDate(t){if(-1!=t.indexOf("T"))t=t.split("T")[0];else t=t.split("I")[0];return t}function formatGoogleDate(t){var e=String(t);return e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)}Chart.pluginService.register({beforeDatasetsDraw:function(t){for(var e in t.config.data.datasets)for(var a in e._meta[t.id].data)a._model.skip=!1,a._model.tension=0}});