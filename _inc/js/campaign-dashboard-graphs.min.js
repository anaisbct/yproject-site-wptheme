$(document).ready(function(){var c=JSON.parse(unescape(cookies.vote)),e=JSON.parse(unescape(cookies.funding)),f=JSON.parse(unescape(cookies.campaign_url));var g=[],h=[],j=[],k=0,l=0,n=[],o=[],p={};$.each(c.list_vote.current,function(Q,R){'undefined'==typeof p[R.date]&&(p[R.date]={}),k+=R.sum,p[R.date].list_vote=k}),$.each(c.list_preinvestement.current,function(Q,R){'undefined'==typeof p[R.date]&&(p[R.date]={}),l+=R.sum,p[R.date].list_preinvestement=l}),$.each(c.list_vote.target,function(Q,R){'undefined'==typeof p[Q]&&(p[Q]={}),p[Q].list_vote_target=R}),$.each(c.list_preinvestement.target,function(Q,R){'undefined'==typeof p[Q]&&(p[Q]={}),p[Q].list_preinvestement_target=R}),p=sortObjectByKey(p),$.each(p,function(Q,R){g.push(formatDate(Q)),j.push(R.list_preinvestement),h.push(R.list_vote),n.push(R.list_vote_target),o.push(R.list_preinvestement_target)});var r=$('#preinvestment-intent-values-chart'),s=new Chart(r,{type:'line',data:{labels:g,datasets:[{label:'Pr\xE9-investissements (\u20AC)',fill:!0,lineTension:0.1,backgroundColor:'rgba(147, 98, 109, 0.6)',borderColor:'#93626d',data:j},{label:'Intentions d\'investissements (\u20AC)',fill:!0,lineTension:0.1,backgroundColor:'rgba(180, 180, 180, 0.6)',borderColor:'#B4B4B4',data:h}]}}),r=$('#goal-chart'),s=new Chart(r,{type:'line',data:{labels:g,datasets:[{label:'Objectifs de pr\xE9-investissements (\u20AC)',fill:!1,lineTension:0.1,backgroundColor:'#D3EAE9',borderColor:'#D3EAE9',data:o},{label:'Objectifs d\'intentions d\'investissements (\u20AC)',fill:!1,lineTension:0.1,backgroundColor:'#D2D2D2',borderColor:'#D2D2D2',data:n},{label:'Pr\xE9-investissements (\u20AC)',fill:!0,lineTension:0.1,backgroundColor:'rgba(0, 135, 155, 0.6)',borderColor:'#00879b',data:j},{label:'Intentions d\'investissements (\u20AC)',fill:!0,lineTension:0.1,backgroundColor:'rgba(180, 180, 180, 0.6)',borderColor:'#B4B4B4',data:h}]}});new Chart(document.getElementById('risk-chart'),{type:'bar',data:{labels:['Tr\xE8s faible','Faible','Moyen','Risqu\xE9','Tr\xE8s risqu\xE9'],datasets:[{label:'',data:[c.risk[1],c.risk[2],c.risk[3],c.risk[4],c.risk[5]],fill:!1,backgroundColor:['#93626d','#93626d','#93626d','#93626d','#93626d']}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}});var u={children:[{name:'Impact<br>soci\xE9tal',value:c.more_info.impact},{name:'Produit<br>Service',value:c.more_info.product},{name:'Structure<br>de l\'\xE9quipe',value:c.more_info.team},{name:'Pr\xE9visionnel<br>financier',value:c.more_info.finance},{name:'Autre',value:c.more_info.other}]},v=600,w=d3.scaleOrdinal().range(['#93626d','#a37983','#b39199','#c4a9af','#d4c0c5']),x=d3.pack().size([v,v]).padding(5),z=d3.select('#chart-infos').append('svg').attr('width',600).attr('height',600).attr('class','chart-svg'),A=d3.hierarchy(u).sum(function(Q){return Q.value}).sort(function(Q,R){return R.value-Q.value});x(A);var B=z.selectAll('.node').data(A.children).enter().append('g').attr('class','node').attr('transform',function(Q){return'translate('+Q.x+' '+Q.y+')'}).append('g').attr('class','graph');B.append('circle').attr('r',function(Q){return Q.r}).style('fill',function(Q){return w(Q.data.name)}),B.append('svg:title').text(function(Q){return Q.value+' internautes'}),B.append('foreignObject').attr('width',100).attr('height',100).attr('transform','translate(-50,-30)').append('xhtml:p').style('color','#FFF').style('text-align','center').attr('title',function(Q){return Q.value+' internautes'}).html(function(Q){return Q.data.name});var g=[],C=[],D=[],E=0,F={};$.each(e.list_investement.current,function(Q,R){'undefined'==typeof F[R.date]&&(F[R.date]={}),E+=R.sum,F[R.date].list_investement_current=E}),$.each(e.list_investement.target,function(Q,R){'undefined'==typeof F[Q]&&(F[Q]={}),F[Q].list_investement_target=R}),F=sortObjectByKey(F),$.each(F,function(Q,R){g.push(formatDate(Q)),C.push(R.list_investement_current),D.push(R.list_investement_target)});var r=$('#investment-chart'),s=new Chart(r,{type:'line',data:{labels:g,datasets:[{label:'Valeur des investissements (\u20AC)',fill:!0,lineTension:0.1,backgroundColor:'rgba(0, 135, 155, 0.6)',borderColor:'#00879b',data:C},{label:'Objectifs id\xE9aux',fill:!0,lineTension:0.1,backgroundColor:'rgba(180, 180, 180, 0.6)',borderColor:'#B4B4B4',data:D}]}}),H={datasets:[{data:[e.stats.percent_men,e.stats.percent_women],backgroundColor:['#93626d','#b39199']}],labels:['Hommes','Femmes']},r=$('#sup-stats-chart');new Chart(r,{type:'doughnut',data:H,options:{cutoutPercentage:80}});var g=[],I=[],J=[],K=[],L=[],M={};$.each(c.list_vote.current,function(Q,R){'undefined'==typeof M[R.date]&&(M[R.date]={}),'undefined'==typeof M[R.date.split('T')[0]].nb_vote?M[R.date].nb_vote=1:M[R.date].nb_vote+=1}),$.each(c.list_preinvestement.current,function(Q,R){'undefined'==typeof M[R.date.split('T')[0]]&&(M[R.date.split('T')[0]]={}),'undefined'==typeof M[R.date.split('T')[0]].nb_preinvestement?M[R.date.split('T')[0]].nb_preinvestement=1:M[R.date.split('T')[0]].nb_preinvestement+=1}),$.each(e.list_investement.current,function(Q,R){'undefined'==typeof M[R.date.split('T')[0]]&&(M[R.date.split('T')[0]]={}),'undefined'==typeof M[R.date.split('T')[0]].nb_investement?M[R.date.split('T')[0]].nb_investement=1:M[R.date.split('T')[0]].nb_investement+=1});var N={stat_type:'visits',start_date:c.start.split('T')[0],end_date:e.end.split('T')[0],path:f},O={stat_type:'sources',start_date:c.start.split('T')[0],end_date:e.end.split('T')[0],path:f},P={stat_type:'cities',start_date:c.start.split('T')[0],end_date:e.end.split('T')[0],path:f};$.ajax({url:'../wp-content/plugins/appthemer-crowdfunding/analytics-api/visits.php',type:'POST',data:N,dataType:'json',success:function(Q){var R=[];for(var T in Q){var R=formatGoogleDate(Q[T].date);'undefined'==typeof M[R]&&(M[R]={}),M[R].visits=Q[T].visits}M=sortObjectByKey(M),$.each(M,function(X,Y){g.push(formatDate(X)),L.push(Y.visits),Y.nb_vote===void 0?I.push(0):I.push(Y.nb_vote),Y.nb_investement===void 0?J.push(0):J.push(Y.nb_investement),Y.nb_preinvestement===void 0?K.push(0):K.push(Y.nb_preinvestement)});var V=$('#visit-chart'),W=new Chart(V,{type:'bar',data:{labels:g,datasets:[{label:'Visites',fill:!0,lineTension:0.1,backgroundColor:'rgba(167,167,167,0.6)',borderColor:'#A7A7A7',data:L,type:'line',yAxisID:'A'},{label:'Votes',yAxisID:'B',data:I,backgroundColor:'#1691A3'},{label:'Investissements',yAxisID:'B',data:J,backgroundColor:'#EA5052'},{label:'Pr\xE9-investissements',yAxisID:'B',data:K,backgroundColor:'#F1A075'}]},options:{scales:{yAxes:[{id:'A',type:'linear',position:'left'},{id:'B',type:'linear',position:'right',ticks:{stepSize:1}}]}}})},error:function(){}}),$.ajax({url:'../wp-content/plugins/appthemer-crowdfunding/analytics-api/visits.php',type:'POST',data:O,dataType:'json',success:function(Q){var R=[],S=[];for(var T in Q)R.push(Q[T].source),S.push(Q[T].visits);var V=$('#chanel-chart'),W=new Chart(V,{type:'pie',data:{labels:R,datasets:[{label:'Visites',data:S,backgroundColor:['#1691A3','#EA5052','#F1A075','#8CC69D','#8A5658']}]}})},error:function(){}}),$.ajax({url:'../wp-content/plugins/appthemer-crowdfunding/analytics-api/visits.php',type:'POST',data:P,dataType:'json',success:function(Q){var T=0;for(var U in Q)T+=Q[U].visits;for(var U in Q)5>U?$('#cities-tab tr:last').after('<tr class="txt-center"><td>'+Q[U].cities+'</td><td>'+Q[U].visits+'</td><td>'+(100*Q[U].visits/T).toFixed(1)+' %</td></tr>'):$('#cities-tab tr:last').after('<tr style="display:none;" class="txt-center"><td>'+Q[U].cities+'</td><td>'+Q[U].visits+'</td><td>'+(100*Q[U].visits/T).toFixed(1)+' %</td></tr>')},error:function(){}});});var sortObjectByKey=function(c){var e=[],f={};for(var g in c)c.hasOwnProperty(g)&&e.push(g);return e.sort(),$.each(e,function(h,j){f[j]=c[j]}),f},cookies=document.cookie.split('; ').map(function(c){return c.split('=')}).reduce(function(c,e){return c[e[0]]=e[1],c},{});function formatDate(c){var c=new Date(c),e=c.getDate(),f=c.getMonth()+1,g=c.getFullYear();return 10>e&&(e='0'+e),10>f&&(f='0'+f),e+'/'+f+'/'+g}function formatGoogleDate(c){var e=c+'',f=e.substring(0,4),g=e.substring(4,6),h=e.substring(6,8);return f+'-'+g+'-'+h}Chart.pluginService.register({beforeDatasetsDraw:function(c){for(dataset of c.config.data.datasets)for(data of dataset._meta[c.id].data)data._model.skip=!1,data._model.tension=0}});
